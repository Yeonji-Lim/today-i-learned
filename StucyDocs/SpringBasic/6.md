# H2
파일로 직접 접근하는게 아니라 소켓을 통해서 접속

`generated by default as identity` : null이면 값을 알아서 채워줌

MemoryMemberRepository에서 sequence와 같은 역할임

최초에 테이블을 만들어두어야 한다.

test.mv.db 의 맨 앞 test가 url 마지막과 일치해야함

# 순수 Jdbc
```java
//JdbcMemberRepository
...
	pstmt = conn.prepareStatement(sql,  
	        Statement.RETURN_GENERATED_KEYS); //DB상에 AUTO_INCREMENT로 인해 자동으로 생성되어진 key(=id)를 가져오는 쿼리  
	pstmt.setString(1, member.getName());  
	pstmt.executeUpdate();  
	rs = pstmt.getGeneratedKeys(); //RETURN_GENERATED_KEYS에 연결
...
```

```java
//JdbcMemberRepository
private Connection getConnection() {  
    return DataSourceUtils.getConnection(dataSource); // 이렇게 유틸을 통해 가져와야 트랜잭션을 유지시켜준다.  
}

private void close(Connection conn) throws SQLException {  
    DataSourceUtils.releaseConnection(conn, dataSource); // 닫을 때에도 util에 있는 릴리즈를 통해 닫아 주어야 한다.  
}
```

# 스프링 통합 테스트

```java
@Autowired MemberRepository memberRepository; // Config에 있는 구현체를 알아서 가져온다!  
  
@Test  
//@Commit //이렇게 하면 그냥 커밋해버리는 옵션  
public void 회원가입() throws Exception {  
    Member member = new Member();  
    member.setName("hello");  
  
    Long saveId = memberService.join(member);  
  
    Member findMember = memberRepository.findById(saveId).get();  
    assertEquals(member.getName(), findMember.getName());  
}
```

가급적이면 단위 테스트가 더 좋음
스프링 컨테이너 없이도 테스트할 수 있도록 훈련하자.
스프링 컨테이너까지 올려야 한다면 잘못 짰을 확률이 높다.
통합 테스트도 필요하지만 단위테스트를 잘 만드는 것이 진짜 중요함 

@Rollback(false)를 올리면 데이터가 쌓임

# 스프링 JdbcTemplate
실무에서 많이 쓴다.

option + enter : 람다 스타일로 바꾸기

# JPA
자바 진영의 표준 인터페이스인 것이고 이 구현체로 hibernate 등등 여러가지 벤더가 있음

ORM, Object RDB Mapping 

```java
@GeneratedValue(strategy = GenerationType.IDENTITY)
```
DB가 자동으로 DB의 인덱스가 증가시키는 것을 IDENTITY라고 함

EntityManager
- data-jpa를 가져오고 나면 spring boot가 자동으로 생성해 줌
- 만들어진 것을 Injection하면 되는 것
- DB랑 통신하고 그런 것들을 내부적으로 처리해준다.

command + option + N : inline으로 만들기

```java
@Override  
public List<Member> findAll() {  
    return em.createQuery("select m from Member m", Member.class).getResultList();  
}
```

객체 자체를 select 한다.

PK 기반이 아닌 것들은 JPQL을 작성해주어야 한다.

# 스프링 데이터 JPA

인터페이스로 구현해두면 스프링 데이터 JPA가 구현체를 자동으로 만들어준다.