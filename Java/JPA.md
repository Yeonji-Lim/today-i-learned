# Java [Persistence](Persistence.md) API

RAM이 아니라 하드디스크에 저장되는 것이랑 비슷한 느낌

JAVA에 있는 데이터를 영구히 기록할 수 있는 환경을 제공하는 [API](CE/SE/API.md)

## 1. JPA는 [ORM 기술](ORM.md)이다.
JPA는 JAVA 진영의 ORM 기술 표준이다.

JAVA 어플리케이션과 JDBC 사이에 위치하고 있다.

![](https://i.imgur.com/w5MO94a.png)


## 2. JPA는 반복적인 [CRUD](CRUD.md)작업을 생략하게 해준다.

원래는 이 작업을 위해서 자바가 DB에게 커넥션을 요청함 그러면 DB는 필요한 세션을 열어줌

그렇게 되면 연결이 되고 자바는 커넥션을 가지게 된다.

자바는 그러면 쿼리를 전송할 수 있다 데이터 베이스는 해당하는 처리를 해주고 자바에 응답을 하게 됨

자바는 이걸 받아서 데이터 베이스의 데이터 타입을 자바 오브젝트로 변경해야 한다.


위와 같은 일을 원래는 반복적으로 해줘야 하는데,

JPA를 쓰게 되면 이러한 일들을 함수 하나로 제공!

## 3. JPA는 영속성 컨텍스트를 가지고 있다.

영속성 : 어떤 데이터를 영구적으로 저장

자바에서는 데이터를 영구적으로 저장할 때 파일 시스템이 아니라 DB를 이용한다.

컨텍스트 : Context, 어떤 대상의 모든 정보

개념이 많이 모호한 편임


영속성 컨텍스트

어떤 데이터를 DB에 저장하려 한다고 하자

그러면 바로 직접적으로 데이터가 DB에 바로 접근하는 것이 아니라 그 중간에 영속성 컨텍스트라는 것이 있다.

프로그램에서 DB에 접근하는 모든 정보를 영속성 컨텍스트가 알고있다.

DB에 저장하기 전에 영속성 컨텍스트 : 자바가 저장하는 모든 데이터를 알고 있다.


그래서 데이터를 저장하고 있으면 프로그램(자바)는 영속성 컨텍스트에 데이터를 던진다.

영속성 컨텍스트는 데이터를 데이터 베이스에 준다. 그렇게 해서 DB에 데이터가 저장된다.


그런데 그리고 나서 영속성 컨텍스트에서 이 데이터를 삭제하면 DB에 있는 해당 데이터가 삭제된다.

즉 영속성 컨텍스트에 있는 데이터와 데이터 베이스에 있는 데이터가 동기화되는 것!


어떤 데이터를 요청할 때 영속성 컨텍스트에 해당하는 데이터가 없다면 영속성 컨텍스트는 DB에서 해당하는 데이터를 가져다가

자바 객체로 변환하여 가지고 있는다. (내용은 같고 타입이 다름)

그리고 나서 영속성 컨텍스트가 자바 객체로 변환된 해당 데이터를 프로그램에게 넘겨준다.

이 상태에서 DB, 영속성 컨텍스트, 프로그램에 있는 그 데이터는 동일하다.


이때 프로그램에서 이 데이터를 변경하면 영속성 컨텍스트의 데이터는 자동으로 변경된다.

이 데이터를 DB에 넣으려고 시도하면 DB에 있는 데이터와 영속성컨텍스트에 있는 데이터가 달라진다.

이때는 insert 가 아니라 update가 자동으로 일어난다.

이런 일을 해주는 것이 영속성 컨텍스트.


자바가 DB에 대해 해야하는 모든 메타 데이터들을 영속성 컨텍스트가 가지고 있다.


## JPA는 DB와 OOP의 불일치성을 해결하기 위한 방법론을 제공한다.

DB의 특징 중 하나는 각각의 컬럼들을 가질 수 있는 자료가 기본 자료형이라는 것이다.

오브젝트를 가질 수 없음! 이를 해결하기 위해서 foreign key를 사용한다.


그런데 자바의 입장에서 보자

이 DB의 형태를 그대로 가져간다고 했을 때 foreign key의 값만을 알 수 있다.

구체적으로 어떤 객체를 가지고 있는지 확인하려면, 두번의 select를 하거나 join을 이용해야 한다.


그런데 자바는 기본 자료형이 아닌 오브젝트를 저장할 수 있다.

그렇게 해서 한번에 확인할 수 있다.


그러면 DB와 자바에서의 형태가 다르게 된다.

이때 JPA가 자동으로 자바에서 객체로 표현된 것에 자동으로 데이터를 매핑해준다.

DB에서는 JPA가 자동으로 foreign key를 생성해준다.

## JPA는 OOP의 관점에서 모델링을 할 수 있게 해준다.

상속, 컴포지션, 연관관계가 가능하다.

​
## JPA는 방언(dialect)처리가 용이하여 Migration을 하기 좋다. 

유지보수에도 좋다.

JPA에 연결되는 DB는 여러종류가 가능하다. 추상화객체로 다루기 때문에 이 추상화객체가 어떤 거냐에 상관이 없다.

마치 우리가 종이에 글을 쓸 때와 마찬가지다.

연필로 쓰다가 볼펜으로 쓴다고 글을 쓰지 못하는게 아니고 만년필, 붓, 형광펜 등 어떤 필기도구든지 그 필기도구를 이용해서 글을 쓸 수 있다.
