# Thread

**하드웨어와 소프트웨어로 나누어서 생각해야 함**

## 하드웨어적 스레드
'실행 흐름의 단위'
하나의 코어가 동시에 처리하는 명령어의 단위

하나의 코어가 하나의 스레드를 가질 때 싱글 코어 싱글스레드 프로세서
하나의 코어가 두 개의 스레드를 가질 때 싱글 코어 멀티스레드 프로세서
두개의 코어가 각각 두 개의 스레드를 가질 때 멀티 코어 멀티스레드 프로세서
## 소프트웨어적 스레드
운영체제에서의 스레드는 이것을 의미한다.

'하나의 프로그램에서 독립적으로 실행되는 단위'

![](https://i.imgur.com/plKu67i.png)

[Process](Process.md)가 할당받은 자원을 이용하는 실행의 단위, 작업을 담당하는 최소 실행 단위

하나의 프로세스에서는 여러 개의 쓰레드([CPU](CPU) 코어 개수만큼) 생성 가능

쓰레드들 간에는 동일 프로세스의 데이터에 접근 가능

-> 프로세스 내의 Heap, Data, Code 영역을 공유한다. 

Light weight process라고도 한다. 

CPU의 입장에서 작업의 최소 단위

## 왜 생겨남?
[context switching](Context_Switching.md) 비용을 줄이기 위해'

프로세스에는 code, data, stack, heap이 있는데 프로세스가 전환(context switching)되면 이 영역을 모두 내리고 실행하고자 하는 프로세스의 code, data, stack, heap을 다시 불러와야 함 

스레드의 경우 context switching 비용이 적다. stack(얘만 공유 안함)만 교체하면 되기 때문

## 구성
각 스레드는 독립적인 작업을 수행해야하기 때문에 다음을 가지고 있음

- 고유한 스레드 ID
- 프로그램 카운터
- 레지스터 집합
- 스택

## 동기화 이슈
**동기화** : 작업들 사이에 실행 시기를 맞추는 것
동일한 자원을 여러 쓰레드가 동시에 수정시 발생  (읽는 것은 상관 없음)

### 해결 방안 
기본적으로 어느 한 쓰레드가 공유 변수를 갱신하는 동안 다른 쓰레드가 동시 접근하지 못하도록 막는다.

#### Mutual exclusion(상호 배제)

#### Mutex (Binary Semaphore)

#### Semaphore

## 장점
1. 자원 공유 효율 : 쓰레드 간의 커뮤니케이션은 IPC 같은 기법이 필요 없음
2. 사용자에 대한 응답성 향상

## 단점
1. 하나의 프로세스에 생성된 쓰레드 중 하나만 문제 있어도 해당 프로세스 전체에 영향
    -> 왜? : stack을 제외한 code, data, heap을 모두 공유하고 있기 때문, 모든 스레드에 에러를 내게 되며 결과적으로 프로세스가 종료된다.
2. 여러 쓰레드를 생성하고 실행시 성능 저하 가능

## Deadlock

무한 대기 상태
두 개 이상의 작업이 서로 상대방의 작업이 끝나기 만을 기다림, 다음 단계로 진행하지 못함

배치  처리 시스템에서는 일어나지 않는 문제

## Starvation

